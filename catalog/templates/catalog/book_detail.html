{% extends "catalog/base.html" %}
{% load static %}

{% block title %}{{ book.title }} | Local Library{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">{{ book.title }}</h1>

  {% if book.book_image %}
    <img src="{{ book.book_image.url }}" alt="{{ book.title }}" class="img-thumbnail mb-4" style="max-height:300px;">
  {% endif %}

  <p><strong>Author:</strong> <a href="{% url 'author_detail' book.author.pk %}">{{ book.author }}</a></p>
  <p><strong>Summary:</strong> {{ book.summary }}</p>
  <p><strong>ISBN:</strong> {{ book.isbn }}</p>
  <p><strong>Genre:</strong> {{ book.genre.all|join:", " }}</p>

  {% if user.is_staff %}
    <div class="mb-3">
      <a href="{% url 'book_update' book.id %}" class="btn btn-warning me-2">‚úèÔ∏è Edit Book</a>
      <a href="{% url 'book_delete' book.id %}" class="btn btn-danger">üóëÔ∏è Delete Book</a>
    </div>
  {% endif %}

  <hr>

  <h4>Copies</h4>
  {% for copy in book.bookinstance_set.all %}
    <div class="border rounded p-3 mb-3">
      <p><strong>ID:</strong> {{ copy.id }}</p>
      <p><strong>Imprint:</strong> {{ copy.imprint }}</p>

      <p>
        <strong>Status:</strong>
        <span class="
          {% if copy.status == 'a' %}text-success
          {% elif copy.status == 'm' %}text-danger
          {% else %}text-warning{% endif %}
        ">
          {{ copy.get_status_display }}
        </span>
      </p>

      {% if copy.status != 'a' %}
        <p><strong>Due back:</strong> {{ copy.due_back }}</p>
      {% endif %}

      {% if copy.status == 'a' and user.is_authenticated %}
        <form method="post" action="{% url 'loan_book' copy.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary btn-sm">üìö Loan this book</button>
        </form>
      {% endif %}
    </div>
  {% empty %}
    <p>No copies of this book are available.</p>
  {% endfor %}
</div>
{% endblock %}
